<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Acquisition (T1M)</title>
</head>

<body>
<p class="date">Date de mise &agrave; jour : 05 mars 2011</p>
<h1>Acquisition (T1M) </h1>



<h1>Faq </h1>

   <b>EURREUR: Lorsqu'on clique sur le bouton GPS et que l'erreur survient : version = 775 No GPS meinberg card found Meinberg 
   </b>
   en tant que root taper la commande : modprobe mbgclock


<h1>Installation sous openSUSE 12.2 i586 (Octobre 2012)</h1>

<pre>

 === Utilisateur t1m : accès au port série

  ls -l /dev/ttyS0
   crw-rw---- 1 root dialout 4, 64 Oct  7 01:31 /dev/ttyS0

  Vérifier que l'utilisateur t1m est dans le groupe dialout :

   dans un terminal utiliser la commande 'id' :
    uid=1000(t1m) gid=100(users) groups=100(users),16(dialout),17(audio),33(video)

   Si ce n'est pas le cas utiliser yast pour l'y ajouter ; il est
   ensuite nécessaire de déconnecter l'utilisateur et de le reconnecter.
 

 === Installation des paquetages ===

 Lancer le gestionnaire de paquetage d'openSUSE, afficher les "Patterns" et installer :

  Base Developpement
  C/C++ Developpement
  Linux Kernel Developpement
  Tcl/Tk Developpement

 Dans un terminal, lancer la commande :
 
  sudo zypper install gsl gsl-devel libusb1_0-devel libusb-compat-devel


 === Compilation ===

 cd /usr/local/src/audela/src/audela
 
 ./configure &gt; log_config.log 2&gt;&amp;1
 make external &gt; log_external.log 2&gt;&amp;1
 make contrib &gt; log_contrib.log 2&gt;&amp;1
 make &gt; log_make.log 2&gt;&amp;1


 === Compilation et installation du pilote Andor ===

 cd /usr/local/src/audela/src/libcam/libandorusb/driverAndor

 Editer le fichier install_andor pour remplacer :
  PLAT="x86_64" par PLAT="i586"

 Utiliser 'su' pour passer root ; lancer la commande
  ./install_andor
 et choisir l'option 5 : All USB Cameras

 Consulter le fichier ../FAQ : editer /etc/udev/rules.d/andor.rules pour
 remplacer SYSFS{idVendor}=="136e", MODE="0666"
 par       ATTR{idVendor}=="136e", MODE="0666"

 cd /usr/local/src/audela/src/libcam/libandorusb/linux

 make

 === Compilation et installation du pilote Meinberg ===

 cd /usr/local/src/audela/src/external/meinberg/Driver/Linux

 tar zxf mbgtools-lx-dev-2011-12-19.tar.gz

 cd mbgtools-lx-dev-2011-12-19

 Lire le fichier README.
 Preparation de l'environnement de compilation des modules pour le noyau Linux.
 Utiliser 'su' pour passer root.
   cd /usr/src/linux
   make cloneconfig
   make modules_prepare
   Quitter l'environnement root.

 De retour dans mbgtools-lx-dev-2011-12-19 :
  make
  make install
  Entrer le mot de passe root lorsqu'il est demandé.

 cd /usr/local/src/audela/src/external/meinberg/linux

 ./cmd

 === Redémarrer le PC ===

 Suite à l'installation des pilotes Andor et Meinberg, les éléments
 suivants ont été ajoutés au système :
  - des modules pour le noyau Linux
  - des librairies dans /usr/local/lib
  - des règles d'accès au périphériques (/etc/udev)

 Seul un redémarrage permet d'être certain que l'ensemble de ces modifications
 fonctionne correctement.

 === Configuration et vérification ===

  Depuis un terminal, lancer /usr/local/src/audela/bin/audela.sh

  == Caméra Andor USB

  Dans le menu "Configuration / Camera" sélectionner l'onglet "AndorUSB" et
  ajuster les paramètres :

   Répertoire contenant les fichiers de configuration : /usr/local/etc/andor
   [X] Inverser Haut/Bas
   [X] Inverser Gauche/Droite
   [X] Refroisissement à la température de -50°C
   Fonctionnement de l'obturateur : Synchro
   Délai d'ouverture de l'obturateur : 0 ms
   Délai de fermetrue de l'obturateur : 30 ms

  Cliquer sur [Ok]

   En bas à droite de la fenêtre, on doit lire : "Caméra A : DZ936_BV"
 
   Si, dans le terminal, le message suivant s'affiche :
    open() failed: No such file or directory
   c'est que :

    - la caméra n'est pas branchée

    - la librairie andorusb n'a pas chargé la bonne version de la libusb
       (note : je n'ai pas réussi à reproduire cette erreur)

  Si la caméra est bien détectée, aller dans le menu "Camera / Acquisition(T1M)".

  == GPS Meinberg

  ( Dans l'outil Acquisition(T1M) )

  Cliquer sur le bouton [GPS] :
   Vérifier que le bouton devient vert.
   Vérifier qu'il n'y a pas d'erreur dans la Console.

  Cliquer sur le Bouton [Binning], pour afficher [Binning 2x2].

  Pose : 1 sec.

  Obt. : Synchro

  Choisir : "Une Image"

  Cocher : "Avancement de l'acquisition"

  Cliquer sur le bouton [GO CCD]

   Le bouton [GPS] doit rester vert.
   Il ne doit pas y avoir de message d'erreur dans la Console.

  Afficher les en-têtes FITS (menu Fichier).

   Vérifier la présence des champs suivants :
    GPS-ANTE = Antenna is connected  Status of GPS Antenna   
    GPS-FANT = 1  flag = 1 if GPS Antenna is connected, 0 otherwise   
    GPS-FLAG = 1  flag = 1 if GPS datation is valid, 0 otherwise   none
    GPS-FSYN = 1  flag = 1 if GPS Time is synchronized, 0 otherwise   
    GPS-PC = 0.2969999999999999862  difference between GPS Clock and Computer Clock   second
    GPS-SYNC = Time is synchronized  Status of GPS Synchronization

   Repérer le bloc suivant :  
    DATE-END = 2012-10-07T00:39:59.074  End date of the observation   Date ISO8601
    DATE-GPS = 2012-10-07T00:39:59.074   Begining date of the observation from GPS Clock   Date ISO8601
    DATE-OBS = 2012-10-07T00:39:58.074  Begining date of the observation   Date ISO8601
    DATE-PC = 2012-10-07T00:39:57.777  Begining date of the observation from Computer Clock   Date ISO8601
   et vérifier :
    DATE-OBS est égal à DATE-GPS moins la valeur du champ "Pose" de l'interface
    DATE-END est égal à DATE-GPS

  == Roue à filtres (sur port série)

   Cliquer sur le bouton [Filtre : ] et vérifier les messages dans la Console.
   Cliquer sur le bouton à droite du bouton [Filtre : ], sélectionner un autre filtre
   et vérifier l'afficheur de la raquette.


 === Point à vérifier en cas de problèmes ===

 == Caméra Andor USB

 La commande lsusb doit lister un périphérique dont l'identifiant est 136e:000c
 par exemple
  Bus 002 Device 007: ID 136e:000c

 Vérifier que le fichier est en lecture/ecriture par tous les utilisateurs.
  ls -l /dev/bus/usb/002/007
   crw-rw-rw- 1 root root 189, 134  7 oct.  01:00 /dev/bus/usb/002/007

 Vérifier la présence du fichier /etc/udev/rules.d/andor.rules contenant la ligne
  ATTRS{idVendor}=="136e", MODE="0666"

 === Carte GPS Meinberg

 Vérifier le statut du gps :

  t1m@brontosaure:~&gt; mbgstatus 

  mbgstatus v3.4.99 Copyright Meinberg 2001-2011

  GPS180PEX 029511005710 (FW 1.05, ASIC 8.05) at port 0xCC00, irq 16
  Normal Operation, 9 sats in view, 3 sats used
  Date/time:  Su, 2012-10-07  01:04:42.56 UTC
  Status info: Antenna is connected
  Status info: Time is synchronized
  Status info: Receiver position has been verified
  Last sync:  Su, 2012-10-07  01:04:00.00 UTC
  Receiver Position:
    lat: +42.9360 lon: +0.1424 alt: 2902m
    latitude:  N  42 deg 56 min 09.72 sec
    longitude: E   0 deg 08 min 32.81 sec
  UTC offset parameter: 16s, no leap second announced.

 Verifier la présence du fichier : /etc/udev/rules.d/55-mbgclock.rules

 Vérifier la présence du module :
  ls /lib/modules/`uname -r`/extra/mbgclock.ko

 Vérifier que le module est chargé :
  lsmod | grep mbgclock

 Si ce n'est pas le cas :
  modprobe mbgclock

</pre>

</body>

</html>
