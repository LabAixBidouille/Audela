
set visuNo 1
set bufNo [::confVisu::getBufNo 1]

#-------------------------------------------------------------------------------
test audace_conftel_model_save {save model} -constraints {
   AUDACE
} -setup {
   #--- j'efface le fichier au cas ou il existerait deja
   file delete -force [file join $::audace(rep_images) ohp100531.xml]

} -body {

   set fileName     [file join $::audace(rep_images) ohp100531.xml]
   set name         "ohp_100531"
   set date         "2010-05-31T19:53:57"
   set comment      ""
   set starList     { {5.55154979532 3.51799653788 {} {} {} {} {} {} {} {} {}} {6.27482013185 11.043264181 {} {} {} {} {} {} {} {} {}} {7.03636537294 18.5667245074 {} {} {} {} {} {} {} {} {}} {7.86859350521 26.0868460761 {} {} {} {} {} {} {} {} {}} {8.8157848519 33.6015340585 60221 12h20m55s -13d33m56s 2451545 2010-05-04T21:31:51 12h20m52.58s -13d19m52.22s 101325 290} {9.94483996069 41.1076183122 61558 12h36m47s -05d49m54s 2451545 2010-05-02T22:12:20 12h36m43.37s -05d39m11.73s 101325 290} {11.3669066575 48.5998193343 68776 14h04m37s +02d17m51s 2451545 2010-05-02T23:28:50 14h04m32.42s +02d27m21.59s 101325 290} {13.2866086831 56.0683808921 61960 12h41m53s +10d14m09s 2451545 2010-05-02T22:27:25 12h41m47.16s +10d22m14.36s 101325 290} {16.1317355038 63.4927725543 67787 13h53m12s +17d55m58s 2451545 2010-05-02T23:22:34 13h53m05.29s +18d03m12.13s 101325 290} {20.9697899802 70.8210754956 68103 13h56m34s +27d29m31s 2451545 2010-05-02T23:25:59 13h56m25.04s +27d36m31.77s 101325 290}  }
   set symbols      { IH ID NP CH ME MA FO HF DAF TF }
   set coefficients { 11.424424219 12.8361639832 1.80558406967 -1.38691888981 -0.824109646345 1.28906998269 1.02847628372 1.27501748699 0.0656723403247 2.00150157105 }
   set chisquare    469.917604842
   set covars       { { 0.483814209827 0.0384915717846 0.435974341057 -0.350193323912 0.0408350495957 -0.0451391293484 -0.08284906225 0.0425404831818 0.306152525338 0.00323749757674 } { 0.0384915717846 0.185838585745 0.0118454109935 0.0156100124145 0.0218184685294 -0.0420694101709 -0.227388977925 0.0443552941149 0.0852784780315 0.0455986674244 } { 0.435974341057 0.0118454109935 0.494826757481 -0.339563663608 -0.0130231221835 -0.0138911328956 9.37138922393e-005 0.0142632834491 0.325048613148 0.000996308740025 } { -0.350193323912 0.0156100124145 -0.339563663608 0.620881640381 -0.0347769876255 -0.018305887155 0.0177384716931 -0.00827401236817 0.238077777986 0.00131294657549 } { 0.0408350495957 0.0218184685294 -0.0130231221835 -0.0347769876255 0.291775344883 -0.0255865538212 -0.31559046519 0.235769175837 -0.00476713808623 0.00183513521838 } { -0.0451391293484 -0.0420694101709 -0.0138911328956 -0.018305887155 -0.0255865538212 0.0493348662907 0.0715058200223 -0.0160539487793 -0.100006211023 -0.00353842691185 } { -0.08284906225 -0.227388977925 9.37138922393e-005 0.0177384716931 -0.31559046519 0.0715058200223 0.602834766568 -0.262517040073 -0.0883153443648 -0.02152119273 } { 0.0425404831818 0.0443552941149 0.0142632834491 -0.00827401236817 0.235769175837 -0.0160539487793 -0.262517040073 0.278011113486 0.042237518806 0.0968770482888 } { 0.306152525338 0.0852784780315 0.325048613148 0.238077777986 -0.00476713808623 -0.100006211023 -0.0883153443648 0.042237518806 0.860533692276 0.00717270958727 } { 0.00323749757674 0.0455986674244 0.000996308740025 0.00131294657549 0.00183513521838 -0.00353842691185 -0.02152119273 0.0968770482888 0.00717270958727 0.133175605155 } }
   set refraction   0

   ::modpoi2::main::saveModel $fileName $date $comment $starList $symbols $coefficients $covars $chisquare $refraction

   set result [file exists [file join $::audace(rep_images) ohp100531.xml]]
   return $result
} -cleanup {
} -result "1"

#-------------------------------------------------------------------------------
test audace_conftel_model_load {load model} -constraints {
   AUDACE
} -setup {
   #--- je charge le package modpoi2
   package require modpoi2
   ::confVisu::createPluginInstance $visuNo ::modpoi2
   ::confVisu::selectTool $visuNo ::modpoi2
} -body {

   set data [::confTel::loadModel [file join $::audace(rep_images) ohp100531.xml]]

   set name         [lindex $data 0]
   set date         [lindex $data 1]
   set comment      [lindex $data 2]
   set starList     [lindex $data 3]
   set symbols      [lindex $data 4]
   set coefficients [lindex $data 5]
   set chisquare    [lindex $data 6]
   set covars       [lindex $data 7]
   set refraction   [lindex $data 8]

   if { $date != "2010-05-31T19:53:57" } {
      set result "date != 2010-05-31T19:53:57"
  } elseif { $chisquare != 469.917604842 } {
      set result "chisquare != 469.917604842"
   } else {
      set result ""
   }

   #--- result est vide s'il n'y a pas d'erreurs, sinon il contient le message d'erreur
   return $result
} -cleanup {
   #--- je supprime le package de la mémoire
   ::confVisu::deletePluginInstance $visuNo ::modpoi2
   package forget modpoi2
   #--- je supprime le fichier
   file delete -force [file join $::audace(rep_images) ohp100531.xml]
} -result ""

