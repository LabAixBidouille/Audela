<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>



<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /><title>A.T.O.S.</title></head><body>
<p class="date">Date de mise à jour : 27 octobre 2012</p>
<h1>A.T.O.S. - Acquisition et Traitement pour les Occultations Stellaires</h1>
<p>
Auteurs : Frédéric Vachier (fv at imcce.fr),
Stephane Vaillant, Jerome Berthier  
</p><p>



Ce plugin va vous permettre de :
<ul>
   <li> Analyser les mesures de photocentre avant l'acquisition qui permet
   de trouver les meilleurs reglages de la camera avant de lancer l'acquisition<li>
   <li> Faire l acquisition Video d'un occultation stellaire.<li>
   <li> Dater chaque images<li>
   <li> Mersurer la courbe de lumiere<li>
   <li> Trouver la date des evenements<li>
   <li> Construire le rapport PLANOCCULT<li>
   <li> Gerer ses occultations<li>
</ul>

</p><p>


</p><p>
   Prequis : 
</p><p>
   L'outil est developpé essentiellement sur open suse. 
<ul>
   <li> Installation de gocr et ImageMagick pour la reconnaissance de caractere<li>

</ul>


</p><p>

</p><p>


<h2> Exercice </h2>

Entrainez-vous et essayez de retrouver les résultats présentés.
Telechargez la video d exemple a cette adresse : 
<a href="http://www.imcce.fr/%7Evachier/occultation/demo/sapphoseg.00.avi">http://www.imcce.fr/~vachier/occultation/demo/sapphoseg.00.avi</a>
</p><p>
<a href="exemple.htm">voir l'exemple</a>








</p><h2><img src="../img/help.png" alt="" align="middle" height="48" width="48" />Aide</h2>
A chaque fois la bouée fera référence à cette page.





<h2><img src="../img/setup.png" alt="" align="middle" height="48" width="48" />Configuration du plugin<br />
</h2>

<p>
<img src="../img/conf_01_preferences.png" alt=""  />

</p><p>
- Le "Mode Debug" sert aux développeurs, cela permet d'ajouter quelques fonctionnalités comme ressourcer
l'ensemble du plugin. Pour l'activer il suffit de cocher cette option, de cliquer sur OK, de quitter AudeLA, de sauvegarder
la configuration d'AudeLA et enfin de relancer AudeLA.  
</p><p>- Le "Délai d'affichage durant l'acquisition en millisecondes"
permet de visualiser la vidéo lors de l'acquisition. Le nombre
représente
la cadence d'affichage.
</p><p>
- La "Ligne de commande de l'OCR" permet la reconnaissance des caractères. Elle permet de récupérer la date
inscrite sur les images. Elle nécessite d'installer les outils sous Linux par défaut :
jpegtopnm et gocr. La ligne de commande telle qu'elle est écrite, fournit une chaine
de caractères. Il est donc possible d'utiliser d'autres outils, il suffira de remplacer
la commande.
</p><p>
- La gestion de la taille du disque évite de saturer un filesystem.
</p><p>
- Le "Répertoire projet" est l'endroit où vous stockerez  vos résultats d'occultations.



<p>
<img src="../img/conf_02_ocr.png" alt=""  />
</p><p>

</p><p>



















</p><h2><img src="../img/acquisition.png" alt="" align="middle" height="48" width="48" /> Acquisition d'une vidéo<br />
</h2>

<p>Il faut choisir un répertoire de destination et un nom de fichier pour que l'appui sur le petit drapeau
permette de démarrer l'acquisition.
</p><p>Avant cela, le bouton "Prendre 1 image" affiche une image dans la visu.
</p><p>Les informations vidéo ne sont pas encore renseignées.
</p><p>Le cadre "Photométrie" récupère certaines statistiques sur l'image, l'objet qui nous intéresse et éventuellement
un objet de référence. Pour cela dessiner un cadre dans l'image, et cliquez sur "Select".
 

</p><p>
</p><h2><img src="../img/extraction.png" alt="" align="middle" height="48" width="48" /> Extraction en images FITS<br />
</h2>
<p>
L'extraction va convertir un fichier AVI en une multitude d'images FITS. Cette étape n'est pas nécessaire si
vous utilisez les outils que propose ATOS, puisqu'il traite aussi bien un AVI qu'une liste d'images.

</p><p>On commence par l'ouverture d'une vidéo en cliquant sur le bouton "...".
</p><p>Ce qui a pour effet d'ouvrir une fenêtre de sélection des fichiers *.avi
</p><p>L'appui sur le bouton "Ouvrir" de la fenêtre de sélection des
fichiers a pour effet de charger la vidéo. Il n'est donc pas nécessaire
d'appuyer sur le bouton "Ouvrir" de la fenêtre "Extraction Vidéo AVI".
</p><p> Le bouton "Ouvrir" de la fenêtre "Extraction Vidéo AVI" ne sert que si l'on utilise un copier/coller du chemin du fichier AVI.
</p><p>Une fois la vidéo chargée, vous avez à votre disposition une barre de défilement
qui accède directement à n'importe quelle image du fichier AVI.
</p><p>Les boutons "Avance" et "Retour" font des sauts image par image.
Les boutons "Avance rapide" et "Retour rapide" font des sauts par bloc
de 100 images.
</p><p>Les boutons "Marquer le début" et "Marquer la fin" vont permettre de s'intéresser qu'à une partie de la vidéo.
 
</p><p>Le "Répertoire de destination" est l'endroit où seront stockés toutes les images FITS.
</p><p>Le "Préfixe des fichiers" correspond au nom du fichier qui précèdera la numérotation.
Il peut être par exemple "i". Ce qui aura pour conséquence de fournir les images : i1.fits, i2.fits, etc.
</p><p>Le bouton "Extraction" démarre le processus et remplit le répertoire d'images FITS, jusqu'à la fin de la vidéo.



</p><h2><a name="extraction_heure">
        <img src="../img/time.png" alt="" align="middle" height="48" width="48" />
        Extraction de l'heure
        <br />
        </a>
   </h2>

On utilise avec cette fonctionnalité la possibilité de récupérer
la date incrustée sur une image. A partir de maintenant on peut choisir
d'utiliser une vidéo AVI ou bien un lot d'images.
On retrouve la partie chargement de la vidéo, la barre de défilement,
les boutons de navigation ainsi
que le crop pour se restreindre à une partie de la vidéo.
La datation peut se faire avec ou sans OCR (Reconnaissance Optique de
Caractères).
<p>Sans OCR (OCR n'est pas coché), il suffit de saisir à la main quelques dates et de cliquer sur "Vérifié",
pour que le traitement en appuyant sur l'icône "Démarrer" en bas a gauche, interpole toutes les dates.

</p><p>Avec OCR, il faut cocher la case OCR, choisir le type d'incrustateur, sélectionner la date
avec un cadre dans la "visu", puis cliquer sur "Select"
comme on peut le voir sur l'image ci-dessous :
</p><p>
<img src="../img/capture-atos-visu.png" alt="" height="634" width="821" />
</p><p>
<img src="../img/capture-atos-time-avi.png" alt="" height="599" width="735" />
</p><p>
On peut alors voir qu'à cette étape que le bouton OCR se colore en vert. Cela signifie que la reconnaissance
de caractères a fonctionné et qu'elle a retourné une chaine de caractères sensée représenter
une date.

</p><p>Avant de commencer le processus en cliquant sur l'icône
"Démarrer", il faut impérativement
choisir 2 dates, les vérifier visuellement et manuellement. (une au
début de la vidéo et une à la fin), ensuite il faut se positionner au
début de la vidéo sur une image qui a été vérifiée. Si tout est OK,
vous pouvez cliquer sur l'icône "Démarrer". Cette action démarre
l'extraction de la date. Si l'OCR ne fonctionne pas il sera coloré en
rouge. Dans ce cas le bouton "Interpolé" sera coloré
en vert.
</p><p>Parfois les boutons "OCR" et "Interpolé" seront en vert. Dans ce cas, l'algorithme a trouvé une date
valide, mais cette date présente un problème car il y a un écart trop grand. La valeur interpolée est donc choisie.

</p><p>A la fin du processus, vous pouvez vérifier ce que l'algorithme
a retenu. Eventuellement vous pouvez ajouter des points de vérification
en cas de problème, puis relancer le processus.
</p><p> Cette fonctionnalité se termine en enregistrant la datation dans un fichier *.time dans le même
répertoire que la vidéo, ou que les images FITS. Ce fichier sera réutilisé par la suite.
 

</p><h2><img src="../img/photom.png" alt="" align="middle" height="48" width="48" /> Courbe de lumière</h2>Toujours
le même principe pour le chargement de la vidéo et pour la navigation.
L'espace "Photométrie" permet de récupérer des informations sur la
vidéo. Sur l'image, faire un cadre bien large en évitant de
sélectionner des zones à problème comme la date par exemple. Pour les
sources (objet et référence), il faut faire de petits cadres comme vous
le feriez pour ajuster une gaussienne. L'appui sur l'icône "Démarrer"
lance l'analyse de la vidéo et fournit un fichier de relevés
photométriques. En ayant auparavant généré le fichier .time, la
photométrie sera en plus, datée à quelques millisecondes prés.
<h2><img src="../img/cdl.png" alt="" align="middle" height="48" width="48" />Analyse</h2>







<p>
<img src="../img/capture-analyse-projet.png" alt="" height="649" width="817" />
</p><p>
</p><h3>Projet<br />
</h3>
<h4>Contexte</h4>
- Avant toute chose, il faut se mettre dans le "contexte". Pour ce
faire, il suffit
d'entrer le nom de l'objet occulteur, au sens de Skybot. C'est à dire
ceres, jupiter,
mais aussi a:ceres, ou bien p:jupiter. Ceci afin de distinguer a:io et
p:io. La recherche est insensible à la casse. Pour plus d'informations
sur Skybot, Miriade
et tous les outils développés par l'équipe OV de l'IMCCE, consultez la
page :
<a href="http://vo.imcce.fr">http://vo.imcce.fr</a>

<p>
- La "Date" doit être saisie sous au format ISO.
</p><p>
- La position de l'observateur peut être définie de deux manières, soit vous êtes
sur un site UAI dont la référence existe, soit il faut entrer les coordonnées sous
la forme : longitude (positif vers l'ouest), latitude (positif vers le nord) et
altitude.
</p><p>- Puis vous cliquez sur "Check avec Miriade", ce qui permet
d'obtenir l'éphéméride de l'objet pour la date. Il est nécessaire
d'être connecté à internet pour cette action.
</p><p>
- Sur la droite se trouve le bouton "Aladin", on le retrouvera plus tard dans l'onglet
"Paramètres". Ce bouton permet d'envoyer des requêtes par SAMP.
Il faut au préalable lancer Aladin. Après l'appui du bouton "Aladin" vous trouverez
dans l'application Aladin, les plans du DSS et les catalogues stellaires sur la zone
d'intérêt.
</p><p>
</p>
<h4>Fichiers et Répertoires</h4>

- Le bouton "Parcourir" permet de naviguer dans les répertoires et de sélectionner
un fichier dont l'extension est .atos
<p>
- Le bouton "Charger" recharge toutes les données d'un projet. Un projet concerne
une seule courbe faite à partir d'une seule station d'observation. Il faut donc faire autant
de fichier projet que de station d'observation.
</p><p>
- Le bouton "Générer" va créer un répertoire et un fichier projet à partir de la
date, du nom de l'objet occulteur et de la position de la station d'observation. Il sera donc unique pour
une station d'observation donnée.






</p><h3>Ephémérides</h3>
<p>
<img src="../img/capture-analyse-epheme.png" alt="" height="649" width="817" />
</p><p>
Dans cet onglet se trouve toutes les éphémérides de l'objet occulteur à la date
de l'occultation.
</p><p>
</p><h3>Corrections<br />
</h3>
<p>
<img src="../img/capture-analyse-correct.png" alt="" height="649" width="817" />
</p><p>La première étape de traitement de la courbe est de la corriger
de tout ses
artéfacts. Généralement, lorsque l'on utilise une caméra vidéo, un
système d'insertion
de la date dans les images et un grabber numériques pour numériser la
courbe, des actions sont nécessaires avant de se dire qu'à une date
donnée
nous avons obtenu telle mesure. Un grabber enregistre à la cadence de
25 images par secondes, alors
que l'on peut faire des acquisitions de plusieurs secondes.
</p><p>
Au chargement de la courbe avec le bouton "Ouvrir" apparait une nouvelle fenêtre
qui représente la courbe des mesures en fonction du temps. Le temps s'exprime en seconde
et l'origine est le premier point de la courbe.
</p><p>
 
<img src="../img/capture-analyse-corrections1.png" alt="" height="400" width="600" />
</p><p>
Dans l'exemple ci-dessus, on peut voir sur cette courbe des "paquets" de données.
Comme on a utilisé une Watec 120N avec un grabber, nous avons nos 25 images par
secondes, qui sont représentés par les points bleus. Chaque paquets montrent que
nous avons utilisé le boitier d'intégration de la Watec en intégrant sur 8 images.
Nous pouvons voir donc sur ce graphe que le grabber ne nous renvoie pas le même flux
alors qu'il le devrait.
</p><p>
</p>
<h4>Correction des paquets d'images</h4>
La première correction à faire est de réunir ces paquets de 8 images en
1 seule mesure.
La seconde chose à faire est de déterminer le nombre d'images que nous
devons supprimer au début de la courbe pour pouvoir réunir ces paquets
de 8 images.
<p>Dans la fenêtre de la courbe, le bouton gauche de la souris permet
de définir le zoom.
Choisir le zoom adéquat pour visualiser les paquets d'images à réunir
et à supprimer. Avec le bouton du milieu de la souris, vous pouvez
sélectionner les paquets.
</p><p>Sélectionner les premiers blocs de points à supprimer puis
aller dans l'onglet "Corrections" la fenêtre "Analyse de la courbe de
lumière"
et cliquer sur le bouton "Offset". Alors s'affiche le nombre de points
qui seront supprimés.
</p><p>
Sélectionner les blocs d'images à réunir et cliquer sur "Paquet".  Alors s'affiche
le nombre de points qui seront réunis.
</p><p>
Cliquer sur le bouton "View" pour visualiser l'effet sur la courbe.
</p><p>
<img src="../img/capture-analyse-corrections2.png" alt="" height="400" width="600" />
</p><p>Les points rouges montrent le résultat de la médiane pour chaque
point de chaque paquet. La courbe verte montre un seul point de mesure
qui sera le résultat final que
nous utiliserons ensuite. On voit que la datation de ce point
correspond au premier
point de chaque paquet. Ce qui ne représente pas forcement la réalité
dans le cas
de notre matériel, il faudra éventuellement procéder à la correction
temporelle.
</p><p>
</p>
<h4>Correction temporelle</h4>

Il faut renseigner 2 champs, dont le premier représente le "Temps d'exposition théorique".
<p>
Dans notre exemple, nous avons une intégration de 8 images à 25 images par seconde.
La cadence de 25 images par seconde fournit des images séparées entre elles de 0.04 secondes.
Intégrer sur 8 images cela correspond a un temps d'exposition de 0.32 secondes.
</p><p>
Le second champ est le saut en temps qui permet de dater une image. La raison est
que le système d'intégration de la date sur l'image fournit la date de l'image
suivante. Imaginer qu'à l'instant où la camera intègre, l'image n'existe pas sur le disque,
ni à travers le boitier d'incrustation GPS, il faut donc corriger de cet offset.
Pour tous ceux qui utilisent des Watec + Boitier gps + Grabber, saisissez 0.03.
</p><p>
La correction à appliquer est de -(I/2 + 0.03) secondes, I étant le
temps d'intégration. Les 0.03s viennent du fait que chaque trame est
exposée pendant un temps I mais avec un décalage de 0.02s (donc il y a
un 0.01s qui traine pour récupérer le temps central de cette double
exposition décalée + les 0.02s pour le temps central de l'image en sortie).
</p><p>
Cette correction de -(I/2 + 0.03)s est à appliquer au temps central de
la première image de chaque paquet (ici de 8 images pour 0.32s
d'intégration, la caméra continuant avant la fin de la pose suivante à
sortir des images à la cadence vidéo).
</p><p>
Pour toute information concernant ce sujet, je vous conseille les forums, et évidemment
<a href="http://www.euraster.net">http://www.euraster.net</a> ou plus d'informations auprès d'Eric Frappa ou auprès de Gérard Dangl.
</p><p>
Le résultat obtenu (en cliquant sur "View" pour le visualiser), on peut voir
la courbe verte décalée du bon timing. Nous avons donc une courbe parfaitement datée.
</p><p>
<img src="../img/capture-analyse-corrections3.png" alt="" height="400" width="600" />
</p><p>
</p>
<h4>Correction par une étoile de référence</h4>

Dans le cas où une étoile est visible dans l'image et qu'elle a été mesurée par
l'outil de mesure photométrique, il est possible ici de corriger le flux de l'étoile
occultée.
<h4>Appliquer (les corrections)</h4>

Il suffit de cliquer sur le bouton "Appliquer" pour sauvegarder la courbe. Le
nouveau fichier aura comme terminaison _CORR.csv et on le retrouve dans l'onglet suivant.






<p>
</p><h3>Sélection des "Evènements"</h3>
<p>
<img src="../img/capture-analyse-evenmts.png" alt="" height="649" width="817" />
</p><p>
Avant de continuer il est impératif de charger la nouvelle courbe corrigée
en cliquant sur le bouton "Ouvrir".
A ce stade nous allons sélectionner chaque évènement de la courbe tel qu'ils sont
dessinés en vert sur chaque bouton. En passant la souris sur les boutons, un petit
descriptif de l'action à appliquer s'affiche.
Pour les deux évènements finaux de la liste, il suffit de sélectionner au moins
2 points autour de l'évènement (immersion ou émersion).







</p><p>
</p><h3>Derniers "Paramètres"</h3>
<p>
<img src="../img/capture-analyse-paramet.png" alt="" height="649" width="817" />
</p><p>
Dans cet onglet se trouve la liste des derniers paramètres nécessaires avant le
calcul des évènements.
</p><p>
- La "Distance" en unité astronomique (UA) de l'objet occulteur est calculée à partir
des éphémérides, tout comme la "Vitesse tangentielle".
</p><p>- Le "Diamètre de la bande" n'est pas connu à ce stade, vous
pourriez être sur le
diamètre de l'astéroïde comme sur un bord très décentré. Ce paramètre
sera recalculé à la fin des calculs et le résultat visible sur le
dernier onglet "Rapport". Commencer avec une valeur large, comme par
exemple 100 km, puis recommencer le calcul en ayant
déterminé la bonne valeur. Ce paramètre ne sert qu'à l'affichage des
courbes car les
évènements sont calculés de manière dissociée, immersion puis émersion.
</p><p>
- Renseigner la désignation de l'étoile telle qu'elle a été présentée dans le
descriptif d'occultation. Un étoile peut avoir bien des désignations. Dans le rapport
final, dans notre cas au format des rapports PLANOCCULT, on doit pouvoir
retrouver le même nom d'étoile qui celui diffusé sur les listes.
</p><p>
- Le diamètre de l'étoile peut être estimé en fonction de sa magnitude suivant trois
bandes : B,V et K. Vous trouverez généralement cette information grâce au catalogue
NOMAD1 qui présente de nombreuses longueurs d'onde. Pour ce faire, si vous ne l'avez
pas déjà fait dans le premier onglet "Projet" cliquer sur le bouton "Aladin".
Dans l'application Aladin, en sélectionnant l'étoile vous trouverez toute les informations nécessaires.
</p><p>
- La "Longueur d'onde" de sensibilité du capteur et sa "Bande passante" sont renseignées
par défaut. Les utilisateurs de filtres doivent modifier ces valeurs en conséquence.
</p><p>
- La "Réponse instrumentale" doit être cochée si le système d'acquisition présente
des temps morts. 






</p><p>
</p><h3>Immersion</h3>
<p>
<img src="../img/capture-analyse-immersi.png" alt="" height="649" width="817" />
</p><p>
L'immersion est la disparition de l'étoile occultée. Les paramètres inscrits
dans les zones blanches sont modifiables, même s'ils sont calculés au préalable.
</p><p>
- Le "Temps de pose" par exemple est obtenu par la datation des images et peut ne pas
correspondre avec le temps de pose théorique. 
</p><p>
- La date de référence a été obtenue par sélection sur la courbe. Il est conseillé
de faire le calcul une deuxième fois après avoir obtenu une première solution.
</p><p>
- Le nombre d'instant  et le pas de recherche exprime comment la solution va être
explorée. Le bouton <img src="../img/reload.png" alt="" height="16" width="16" />
permet de calculer la durée totale d'exploration autour de l'évènement.
</p><p>
- Une fois que tout est en place, c'est le moment de cliquer sur l'icône "Calcul".

</p>
<h4>Tout est dans le Chi2</h4>

La solution s'exprime par la valeur du Chi2 minimale. C'est pourquoi
un bon Chi2 est un Chi2 qui ne présente pas de doute sur la solution. Ou encore, il faut obtenir
une jolie courbe qui présente un minimum global dont la forme est proche d'une parabole,
comme dans l'exemple présenté ci-dessous.
<p>
<img src="../img/capture-analyse-chi2-bon.png" alt="" height="492" width="644" />
</p><p>
Il peut arriver que le résultat du chi2 montre un ou des plateaux. A ce moment il faut
essayer de bouger le système en changeant les valeurs de recherche, reprendre d'autres valeurs
pour les plateaux, modifier le temps de référence, etc.
Si rien n'y fait, et que vous obtenez un plateau minimal il ne reste plus qu'à choisir le temps
milieu du plateau.
</p><p>




</p><p>
</p><h3>Emersion</h3>
<p>
<img src="../img/capture-analyse-emersio.png" alt="" height="649" width="817" />
C'est la même chose Comme pour l'immersion, ici on va calculer l'instant de réapparition de
l'étoile.





</p><p>
</p><h3>Informations</h3>
<p>
Les résultats étant obtenu, il ne reste plus qu'à écrire le rapport.
Les 3 onglets suivants sont à remplir pour un rapport complet.
Remplissez le maximum d'informations, c'est aussi pour vous et pour retrouver votre
méthodologie au fil du temps.
</p><p>
<img src="../img/capture-analyse-info1.png" alt="" height="649" width="817" />
</p><p>

</p><p>
<img src="../img/capture-analyse-info2.png" alt="" height="649" width="817" />
</p><p>

</p><p>
<img src="../img/capture-analyse-info3.png" alt="" height="649" width="817" />
</p><p>




</p><p>
</p><h3>Rapport</h3>
<p>
<img src="../img/capture-analyse-rapport.png" alt="" height="649" width="817" />
</p><p>
Le récapitulatif vous présente les principaux résultats obtenus.
Vous obtenez la durée de l'évènement observé mais aussi une estimation de la taille
de la partie de l'astéroïde qui a occulté l'étoile. Cet ensemble de valeurs formera
les cordes des observateurs et c'est grâce à vous que l'on pourra déterminer la taille
mais aussi la forme des astéroïdes.
</p><p>
Vous devez choisir manuellement si votre résultat est Positif ou Négatif.
</p><p>
Le dernier bouton "Création du rapport" permet de créer le fichier PLANOCCULT que vous trouverez dans le répertoire
projet avec l'extension .PLANOCCULT.



</p><p>
</p><h2><img src="../img/dark.png" alt="" align="middle" height="48" width="48" /> Pour s'entrainer</h2>
<p>
Vous pouvez télécharger la vidéo de l'occultation qui a permis d'exposer le fonctionnement de cet outil,
à cette adresse :
</p><p>
<a href="http://www.imcce.fr/%7Evachier/occultation/demo/sapphoseg.00.avi">http://www.imcce.fr/~vachier/occultation/demo/sapphoseg.00.avi</a>
</p><p>
Entrainez-vous et essayez de retrouver les résultats présentés.


</p><p>
</p><h2><img src="../img/dark.png" alt="" align="middle" height="48" width="48" /> La suite ...</h2>
<p>

</p><ul type="none">
<li>Traitement des Dark et Offset</li>
<li>Mesure photométrique si l'astéroïde n'est pas visible</li>
<li>Robustesse de la sélection du périphérique de capture sous Linux</li>
</ul>


<ul type="none">
<li><br />
</li>
<li><br />
</li>
</ul>






</body></html>
