<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<title>A.T.O.S.</title> 
<title>Acquisition et Traitement pour les Occultations Stellaire</title>
</head>

<body>
<p class="date">Date de modification : 10 octobre 2012</p>
<h1>A.T.O.S.</BR>Acquisition et Traitement pour les Occultations Stellaire</h1>
<p>
Auteur : Frédéric Vachier (fv at imcce.fr)
<p>
Ce plugin va vous permettre de manipuler des videos, d'en extraire l'information photométrique, 
et calculer les dates des occultations stellaires et de rédiger le rapport final.
<p>
A ma connaissance, c'est le seul programme complet qui permet de réaliser une occultation, de l'acquisition au rapport final.
Le but de ce projet est d'homogeneiser les resultats dans le monde amateur comme professionnel.
C est aussi le seul programme d'acquisition video qui permette d'avoir une idée de la photometrie avant de lancer 
l'acquisition. C'est fondamental pour choisir les parametres optimaux d'integration et de gain, afin d'obtenir 
la meilleure courbe possible.
<p>
Quelques petits outils supplementaires, vont vous aider 
à extraire des images fits de vos videos, et de recuperer la date de chaque image 
grace a l'outil de reconnaissance de caracteres.
<p>




<h2><img src="../img/help.png" alt="" width="48" height="48" align="middle">Aide</img></h2>
A chaque fois la bouée fera reference a cette page.





<h2><img src="../img/setup.png" alt="" width="48" height="48" align="middle">Configuration</img></h2>

<p> 
<img src="../img/capture-av4l-setup.png" alt="" width="532" height="289" />
<p>
- Le mode debug sert aux developpeur cela permet d'ajouter quelques fonctionnalités comme ressourcer
l'ensemble du plugin. Pour l'activer il suffit de cliquer, repondre OK, quitter Audela, sauvegarder
la configuration d'Audela, et relancer Audela.   
<p>
- Le Délai d'affichage permet de visualiser la video lors de l'acquisition. Le nombre représente
la cadence d'affichage.
<p>
- L'OCR, est la reconnaissance de caractères. Il permet de recuperer la date
inscrit dans les images. Il necessite d'installer les outils sous linux par defaut :
jpegtopnm et gocr. La ligne de commande telle qu'elle est écrite, fournit une chaine 
de caractère. Il est donc possible d'utiliser d'autres outils, il suffira de remplacer
la commande.
<p>
- La gestion de la taille du disque évite de saturer un filesystem.
<p>
- Le repertoire projet est l'endroit où vous stoquerez  vos résultats d'occultations.

<h2><img src="../img/acquisition.png" alt="" width="48" height="48" align="middle"> Acquisition</img></h2>

<p>Il faut choisir un repertoire de destination et un nom de fichier pour que l'appui sur le petit drapeau 
permette de demarrer l acquisition. 
<p>Avant cela, le bouton "Prendre 1 image" affiche une image dans la visu.
<p>Les info video ne sont pas encore renseignées.
<p>Le cadre photometrie recupere certaines statistiques sur l image, l'objet qui nous interesse et eventuellement
un objet de reference. Pour cela dessiner un cadre dans l image, et cliquez sur SELECT.
 

<p>
<h2><img src="../img/extraction.png" alt="" width="48" height="48" align="middle"> Extraction</img></h2>
<p>
L'extraction va convertir un avi en une multitude d'images fits. Cette etape n'est pas necessaire si 
vous utilisez les outils que propose av4l, puisqu'ils traitent aussi bien un avi qu'un liste d'images.

<p>On commence par l ouverture d'une video en cliquant sur les ...
<p>ce qui a l'effet d'ouvrir une fenetre de selection de fichier *.avi
<p>l'appui sur ouvrir a pour effet de charger la video. il n est donc pas necessaire d'appuyer sur "open".
<p> le bouton "open" ne sert que si on fait du copier/coller directement du chemin du fichier avi.
<p>Une fois la video chargée, vous avez a disposition une barre de defilement 
qui accede directement a n'importe quelle image.
<p>les boutons avance et retour font de l'image par image. les boutons rapides change par bloc de 100 images.
<p>Les boutons  setmin/setmax/crop vont permettre de s'interesser qu a une partie de la video.
 
<p>Le repertoire de destination est l'endroit où vont se retrouver toutes les images fits. 
<p>le prefixe est le nom du fichier qui precedera la numerotation. 
Il peut etre par exemple "i". ce qui aura pour consequence de fournir les images: i1.fits, i2.fits, etc...
<p>Le bouton extraction demarre le processus et rempli le repertoire d'images fits, jusqu a la fin de la video.


<h2><img src="../img/time.png" alt="" width="48" height="48" align="middle">Datation</img></h2>

On utilise dans cette partie la possibilité de recuperer la date incrustée dans une image.
a partir de maintenant on peut choisir d'utiliser une video avi, oubien une liste d'image.
On retrouve la partie chargement de la video, la barre de defilement, les bouton de navigtion ainsi
que le crop pour se restreindre a une partie de la video.
La datation peut se faire avec ou sans OCR (Reconnaissance optique de caractères).

<p>Sans OCR, il suffit de rentrer à la main quelques dates et de cliquer sur "Verifié", 
pour que le traitement en appuyant sur le bouton START en bas a gauche, interpole toutes les dates.

<p>Avec OCR, il faut cocher la case OCR. choisir le type d'incrustateur puis selectionner 
un cadre dans la visu autour de la date puis cliquer sur "SELECT"
comme on peut le voir sur cette image :
<p> 
<img src="../img/capture-av4l-visu.png" alt="" width="821" height="634" />
<p>
<img src="../img/capture-av4l-time-avi.png" alt="" width="735" height="599" />
<p>
On peut voir a cette etape que le bouton OCR s'inscrit en vert. cela veut dire que la reconnaissance
de caractere a fonctionné et qu elle a retourné une chaine de caractere sensée representer 
une date.

<p>
avant de commencer le processus en cliquant sur "START", il faut imperativement 
choisir 2 dates et les verfier visuellement et manuellement. (une en debut de video et une en fin)
puis il faut se mettre en debut de video sur une image qui a été verifiée.
si tout est OK vous pouvez cliquer sur START. ce qui demarre l'extraction de la date. 
si l'OCR ne fonctionne pas il apparaitra en rouge. dans ce cas le bouton "interpolé" vas apparaitre 
en vert.
<p>parfois le bouton "OCR" et "interpolé" apparaitront en vert. Dans ce cas l'algo a ramené une date
valide, mais la date a un probleme car elle presente un ecart trop grand. 
la valeur interpolé est donc choisie.

<p>A la fin du processus, vous pouvez verifier ce que l'algorithme a retenu. 
eventuellement ajoutez des points de verification en cas de problemes, puis relancer.

<p> Cet outil se termine en enregistrant la datation dans un fichier *.time dans le meme
repertoire que la video, ou des images fits.
ce fichier sera reutilisé par la suite.
 

<h2><img src="../img/photom.png" alt="" width="48" height="48" align="middle"> Courbe de lumiere</img></h2>

toujours le meme principe de chargement de la video et de sa navigation.
l'espace photometrie permet de récuperer l'information de la video.
Pour l'image, faire un cadre bien large en evitant de prendre des zones a probleme comme la date.
pour les sources, il faut faire des petits cadres comme vous le feriez pour ajuster une gaussienne.

l'appui sur le bouton start va analyser la video et fournir un fichier de relevé photometrique.
en ayant auparavent generé le fichier .time, la photometrie sera en plus, datée a quelques millisecondes prés.


<h2><img src="../img/cdl.png" alt="" width="48" height="48" align="middle">Analyse</img></h2>







<p>
<img src="../img/capture-analyse-projet.png" alt="" width="817" height="649" />
<p>
<h3>Contexte</h3>
- Avant toute chose, il faut se mettre dans le "contexte". Pour ce faire, il suffit
d'entrer le nom de l'objet occulteur, au sens de Skybot. c'est à dire ceres, jupiter,
mais aussi a:ceres, ou bien p:jupiter. Ceci afin de distinguer a:io et p:io.
la recherche est insensible à la casse. pour plus d'information sur Skybot, Miriade 
et tous les outils développés par l'équipe OV de l'IMCCE, consultez la page : 
http://vo.imcce.fr/

<p>
- La Date doit être sous la forme ISO.
<p>
- La position de l'observateur peut etre definie de deux manieres, soit vous etes 
sur un site UAI, dont la reference existe soit il faut entrer les coordonnées sous 
la forme : longitude (positif vers l'ouest), latitude (positif vers le nord), et 
altitude. 
<p>
- Puis 1-clic sur Miriade permet d'obtenir l'ephemeride de l'objet à la date. 
il est nécéssaire d'etre connecté à internet pour cette action. 
<p>
- Sur la droite se trouve le bouton Aladin, on le retrouvera plus tard dans l'onglet
"Parametres". Le bouton permet d'envoyer des requetes par SAMP.
Il faut au préalable lancer Aladin. A l'appuie du bouton "Aladin" vous trouverez
dans l'application Aladin, les plans du DSS et les catalogues stellaires sur la zone
d'interet.
<p>
<h3>Fichiers et Répertoires</h3>
- Le bouton "Parcourir" permet de naviguer dans les repertoires et de selectionner
un fichier dont l'extension est .atos
<p>
- le bouton "Charger" recharge toutes les donnees d'un projet. Un projet concerne 
une seule courbe faite a partir d'une seule station. il faut donc faire autant
de fichier projet que de telescope. 
<p>
- le bouton "Générer" va créer un repertoire et un fichier projet à parir de la 
date, du nom de l'objet occulteur et de la position. Il sera donc unique pour 
une station d'observation.






<h3>Ephémérides</h3>
<p>
<img src="../img/capture-analyse-epheme.png" alt="" width="817" height="649" />
<p>
Dans cet onglet se trouve toutes les éphémérides de l'objet occulteur a la date
de l'occultation.
<p>
<h3>Corrections de la courbe</h3>
<p>
<img src="../img/capture-analyse-correct.png" alt="" width="817" height="649" />
<p>
La premiere etape de traitement de la courbe est de la corriger de tout ses 
artefacts. Généralement, lorsque l'on utilise une camera video un systeme d'insertion
de la date dans les images et un grabber numeriques pour numeriser la courbe dans 
un fichier video, des actions sont nécessaires avant de se dire qu'a une date donnée
nous avons obtenu telle mesure. Un grabber enregistre à 25 images par secondes, alors 
que l'on peut integrer sur plusieurs secondes.
<p>
Au chargement de la courbe par le bouton "Ouvrir" apparait une nouvelle fenetre
qui est la courbe des mesures en fonction du temps. Le temps s'exprime en seconde 
et l'origine est le premier point de la courbe.
<p>
 
<img src="../img/capture-analyse-corrections1.png" alt="" width="600" height="400" />
<p>
Dans l'exemple suivant, on peut voir sur cette courbe des "paquets" de données.
Comme on a utilisé une watec 120N avec un grabber, nous avons nos 25 images par 
secondes, qui sont representés par les points bleus. Chaque paquets montrent que 
nous avons utilisé le boitier d'integration de la watec en integrant sur 8 images.
Nous pouvons voir donc sur ce graphe que le grabber ne nous revoit pas le meme flux
alors qu'il le devrait. 
<p>
<h3>Correction des paquets d'images</h3>
La premiere correction a faire est de reunir ces paquets de 8 images en 1 seule mesure.
La seconde chose a faire est de determiner le nombre d'images que nous devons eviter
en debut de courbe pour pouvoir reunir ces paquets de 8 images.
<p>
Dans la fenetre de la courbe, le bouton gauche de la souris permet de definir le zoom.
Choisir le zoom adequate pour visualiser les paquets d'images a reunir et a supprimer.
avec le bouton du milieu de la souris, vous pouvez selectionner les paquets.
<p>
Selectionner les premiers bloc de points a supprimer puis aller dans la fenetre d'analyse
et cliquer sur le bouton "offset". Alors s'affiche le nombre de point qui seront supprimés.
<p>
Selectionner les blocs d'images à reunir et cliquer sur "paquet".  Alors s'affiche
le nombre de point qui seront reunis.
<p>
Cliquer sur le bouton "view" pour visualiser l'effet sur la courbe.
<p>
<img src="../img/capture-analyse-corrections2.png" alt="" width="600" height="400" />
<p>
les points rouges montre le resultat de la mediane pour chaque point de chaque paquet.
la coubre verte montre un seul point de mesure qui sera le resultat final que 
nous utiliserons ensuite. On voit que la datation de ce point correspond au premier
point de chaque paquet. ce qui ne represente pas forcement la realité dans le cas 
de notre materiel, et il faudra proceder a la correction en temporelle.
<p>
<h3>Correction temporelle</h3>
Il faut inscrire 2 champs qui le premier represente le temps d'exposition théorique.
<p>
- Dans notre exemple, nous avons une integration de 8 images a 25 images par seconde.
25 images par seconde donnent des images separées entre elles de 0.04 secondes.
Intégrer sur 8 images correspond a un temps d'exposition de 0.32 secondes.
<p>
- le second champ est le saut en temps qui permet de dater une image. la raison est 
que le systeme d'integration de la date dans l'image fournit la date de l'image 
suivante. 
imaginez que lorsque la camera integre, l image n existe pas sur le disque , 
ni a travers le boitier d'incrustation GPS. il faut donc corriger de cet offset. 
Pour tout ceux qui utilisent des watec + boitier gps + grabber, inscrivez 0.03.
<p>
La correction à appliquer est de -(I/2 + 0.03) secondes, I étant le
temps d'intégration. Les 0.03s viennent du fait que chaque trame est
exposée pendant un temps I mais avec un décalage de 0.02s (donc il y a
un 0.01s qui traîne pour récupérer le temps central de cette double
exposition décalée + les 0.02s pour le temps central de l'image en sortie). 
<p>
Cette correction de -(I/2 + 0.03)s est à appliquer au temps central de
la première image de chaque paquet (ici de 8 images pour 0.32s
d'intégration, la caméra continuant avant la fin de la pose suivante à
sortir des images à la cadence vidéo). 
<p>
Pour toute information concernant ce sujet, je vous conseille les forums, et evidemment
http://www.euraster.net/ et plus d'info aupres d'Eric Frappa ou aupres de Gerard Dangl.
<p>
Le resultat obtenu (en cliquant sur "view" pour le visualiser, on peut voir 
la courbe verte decalée du bon timing. Nous avons donc une courbe parfaitement datée.
<p>
<img src="../img/capture-analyse-corrections3.png" alt="" width="600" height="400" />
<p>
<h3>Correction par une étoile de référence</h3>
Dans le cas où une étoile est visible dans l'image et qu'elle a été mesurée par
l'outil de mesure photometrique, il est possible ici de corriger le flux de l'etoile
occultée.
<h3>Appliquer les corrections</h3>
Il suffit de cliquer sur le bouton "appliquer" pour sauvegarder la courbe. Le 
nouveau fichier aura comme extension _CORR.csv et on le retrouve dans l'onglet suivant.






<p>
<h3>Selection des évenements</h3>
<p>
<img src="../img/capture-analyse-evenmts.png" alt="" width="817" height="649" />
<p>
Avant de continuer il est impératif de charger la nouvelle courbe corrigées
en cliquant sur le bouton "ouvrir".
A ce stade nous allons selectionner chaque évenement de la courbe tel que 
dessiné en vert sur chaque bouton. En passant la souris sur les boutons un petit
descriptif de l'action à appliquer, s'affiche.
Pour les deux evenements finaux de la liste, il suffit de selectionner au moins 
2 points autour de l'evenement (d'immersion ou emersion)







<p>
<h3>Derniers paramètres</h3>
<p>
<img src="../img/capture-analyse-paramet.png" alt="" width="817" height="649" />
<p>
Dans cet onglet se situe la liste des derniers parametres necessaires avant le 
calcul des evenements. 
<p>
- la distance en unité astronomique de l'objet occulteur est calculé a partir
des ephemerides, tout comme la vitesse tangentielle. 
<p>
- Le diametre de la bande n'est pas connu a ce stade, vous pourriez etre sur le 
diametre de l'asteroide comme sur un bord tres decentré. Ce parametre sera recalculé
a la fin des calculs et le resultat visible sur le dernier onglet "Rapport".
commencer avec une valeur large, comme 100 km, puis recommencer le calcul en ayant 
determiné la bonne valeur. Ce parametre ne sert qu'a l'affichage des courbes car les
evenements sont calculés de maniere dissociée, immersion puis emersion.
<p>
- Renseigner la designation de l'etoile telle qu'elle a été presentée dans le 
descriptif d'occultation. Un étoile peut avoir bien des désignations. Dans le rapport
final, dans notre cas sous la forme des rapports PLANOCCULT, on doit pouvoir 
retrouvé le meme nom de l'etoile qui est diffusé sur les listes.
<p>
- Le diametre de l'etoile peut etre estimé en fonction de sa magnitude suivant trois
bandes : B,V et K. Vous trouverez generalement cette information grace au catalogue 
NOMAD1 qui presente de nombreuses longueur d'onde. Pour ce faire, si vous ne l'avez 
pas deja fait dans le premier onglet "projet" cliquer sur le bouton "Aladin".
Dans l'application Aladin, en selectionnant l'etoile vous trouverez toute l'information.
<p>
- La longueur d'onde de sensibilité du capteur et sa bande passante sont renseingés
par defaut. Les utilissateurs de filtres, doivent modifier ces valeurs en consequence.
<p>
- La réponse instrumentale doit etre coché si le systeme d'acquisition presente 
des temps mort.  






<p>
<h3>Immersion</h3>
<p>
<img src="../img/capture-analyse-immersi.png" alt="" width="817" height="649" />
<p>
L'immersion est la disparition de l'étoile occultée. Les parametres inscrits 
dans les zones blanches sont modifiables, meme s'ils sont calculés au prealable. 
<p>
- Le temps de pose par exemple est obtenu par la datation des images et peut ne pas
correspondre avec le temps de pose theorique.  
<p>
- La date de référence a été obtenue par selection sur la courbe. Il est conseillé
de faire le le calcul une deuxieme fois apres avoir obtenu une premiere solution.
<p>
- Le nombre d'instant  et le pas de recherche exprime comment la solution va etre
explorée. Le bouton <img src="../img/reload.png" alt="" width="16" height="16" />
permet de calculer la duree totale d'exploration autour de l'evenement.
<p>
- Une fois que tout est en place, c'est le moment de cliquer sur le bouton de calcul.

<h3>Tout est dans le Chi2</h3>
La solution s'exprime par la valeur du Chi2 minimale. C'est pourquoi
un bon Chi2 et un Chi2 qui ne presente pas de doute sur la solution. Ou encore,
une jolie courbe qui presente un minimum global dont la forme represente une parabole,
comme dans l'exemple presenté dans l'image suivante. 
<p>
<img src="../img/capture-analyse-chi2-bon.png" alt="" width="644" height="492" />
<p>
Il peut arriver où le resultat du chi2 montre un ou des plateaux. A ce moment il faut 
essayer de bouger le systeme en changeant les valeurs de recherche, reprendre d'autres valeurs
pour les plateaux, modifier le temps de reference, etc...
Si rien n'y fait, et que vous obtenez un plateau minimal il ne reste plus qu a choisir le temps
milieu du plateau.
<p>




<p>
<h3>Emersion</h3>
<p>
<img src="../img/capture-analyse-emersio.png" alt="" width="817" height="649" />
C'est la meme chose que pour l'immersion, ici on va calculer l'instant de reapparition de 
l'etoile.





<p>
<h3>Informations</h3>
<p>
Les resultats etant obtenu, il ne reste plus qu'a ecrire le rapport.
Les 3 onglets suivant sont a remplir pour un rapport complet.
Remplissez le maximum d'information, c est aussi pour vous et pour retrouver votre 
methodologie au fil du temps. 
<p>
<img src="../img/capture-analyse-info1.png"   alt="" width="817" height="649" />
<p>

<p>
<img src="../img/capture-analyse-info2.png"   alt="" width="817" height="649" />
<p>

<p>
<img src="../img/capture-analyse-info3.png"   alt="" width="817" height="649" />
<p>




<p>
<h3>Rapport</h3>
<p>
<img src="../img/capture-analyse-rapport.png" alt="" width="817" height="649" />
<p>
Le récapitulatif vous presente les principaux resultats obtenus.
Vous obtenez la durée de l'evenement observé mais aussi une estimation de la taille
de la partie de l'asteroide qui a occulté l'etoile. Cet ensemble de valeur formera 
les cordes des observateurs et c'est grace a vous que l'on pourra determiner la taille 
mais aussi la forme des asteroides.
<p>
Vous devez choisir manuellement si votre resultat est Positif ou Negatif.
<p>
Le dernier bouton permet de creer le fichier PLANOCCULT que vous trouverez dans le repertoire
projet avec l'extension .PLANOCCULT.






<p>
<h2><img src="../img/dark.png" alt="" width="48" height="48" align="middle"> La suite ...</img></h2>
<p>

<ul type="none">
<li>Traitement des Dark et Offset</li>
<li>Mesure photometrique si l'asteroide n'est pas visible</li>
<li>Robustesse de la selection du periphérique de capture sous Linux</li>
</ul>


<ul type="none">
<li></li>
<li></li>
</ul>





</p></body></html>
